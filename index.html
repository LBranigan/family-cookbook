<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Recipe Collection</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --burgundy: #722F37;
            --burgundy-dark: #5A252C;
            --burgundy-light: #8B3D47;
            --cream: #F5F0E6;
            --cream-dark: #E8E0D0;
            --antique-white: #FDFBF7;
            --gold: #C9A227;
            --gold-light: #D4B23D;
            --brown: #4A3728;
            --brown-light: #6B5344;
            --sage: #8B9A7D;
            --sage-light: #A3B095;
            --ink: #2C2416;
            --paper-shadow: rgba(74, 55, 40, 0.12);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Crimson Pro', Georgia, serif;
            background-color: var(--cream);
            color: var(--brown);
            line-height: 1.7;
            font-size: 18px;
            min-height: 100vh;
            position: relative;
        }

        /* Paper texture overlay - subtle */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.08;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Decorative corner flourishes */
        .flourish {
            position: absolute;
            width: 120px;
            height: 120px;
            opacity: 0.15;
            pointer-events: none;
        }

        .flourish-tl { top: 20px; left: 20px; }
        .flourish-tr { top: 20px; right: 20px; transform: scaleX(-1); }
        .flourish-bl { bottom: 20px; left: 20px; transform: scaleY(-1); }
        .flourish-br { bottom: 20px; right: 20px; transform: scale(-1); }

        /* Header - Full Width Banner with Overlay Text */
        header {
            position: relative;
            text-align: center;
            height: 160px;
            overflow: hidden;
            border-bottom: 3px solid var(--gold);
        }

        .header-banner {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .header-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 1rem 2rem;
        }

        header h1 {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: clamp(1.5rem, 4vw, 2.2rem);
            font-weight: 600;
            color: #fff;
            letter-spacing: 0.04em;
            margin-bottom: 0.25rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        header .subtitle {
            font-family: 'Caveat', cursive;
            font-size: 1.1rem;
            color: var(--gold-light);
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        /* Controls Bar */
        .controls {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--antique-white);
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid var(--cream-dark);
            box-shadow: 0 2px 8px var(--paper-shadow);
        }

        .controls-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
            justify-content: space-between;
        }

        .search-container {
            position: relative;
            flex: 0 1 280px;
            min-width: 200px;
        }

        .search-container::before {
            content: '⌕';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            color: var(--brown-light);
            opacity: 0.6;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            font-family: 'Crimson Pro', serif;
            font-size: 0.95rem;
            border: 1px solid var(--cream-dark);
            border-radius: 6px;
            background: var(--cream);
            color: var(--brown);
            outline: none;
            transition: all 0.2s ease;
        }

        .search-input::placeholder {
            color: var(--brown-light);
            opacity: 0.6;
        }

        .search-input:focus {
            border-color: var(--burgundy);
            background: var(--antique-white);
            box-shadow: 0 0 0 2px rgba(114, 47, 55, 0.1);
        }

        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            justify-content: center;
            flex: 1;
        }

        .filter-btn {
            padding: 0.4rem 0.85rem;
            font-family: 'Crimson Pro', serif;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid var(--cream-dark);
            background: transparent;
            color: var(--brown);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .filter-btn:hover {
            border-color: var(--burgundy);
            color: var(--burgundy);
            background: rgba(114, 47, 55, 0.05);
        }

        .filter-btn.active {
            background: var(--burgundy);
            border-color: var(--burgundy);
            color: var(--antique-white);
        }

        .print-btn {
            padding: 0.4rem 1rem;
            font-family: 'Crimson Pro', serif;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid var(--burgundy);
            background: transparent;
            color: var(--burgundy);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .print-btn:hover {
            background: var(--burgundy);
            color: var(--antique-white);
        }

        /* Stats */
        .stats {
            text-align: center;
            padding: 0.5rem;
            font-family: 'Crimson Pro', serif;
            font-size: 0.85rem;
            color: var(--brown-light);
            background: var(--cream-dark);
        }

        /* Main Content */
        main {
            max-width: 1500px;
            margin: 0 auto;
            padding: 2rem 1.5rem 4rem;
        }

        /* Table of Contents */
        .toc-section {
            background: var(--antique-white);
            border-radius: 4px;
            padding: 2rem;
            margin-top: 3rem;
            box-shadow: 0 1px 4px var(--paper-shadow);
            position: relative;
            border: 1px solid var(--cream-dark);
        }

        .toc-section h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--burgundy);
            text-align: center;
            margin-bottom: 1.5rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .toc-columns {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 2rem;
        }

        .toc-category h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--burgundy-dark);
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed var(--cream-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-category h3::before {
            content: '◆';
            font-size: 0.6rem;
            color: var(--gold);
        }

        .toc-category ul {
            list-style: none;
        }

        .toc-category li {
            padding: 0.3rem 0;
        }

        .toc-category a {
            font-family: 'Crimson Pro', serif;
            font-size: 0.95rem;
            color: var(--brown);
            text-decoration: none;
            transition: all 0.2s ease;
            display: inline-block;
        }

        .toc-category a:hover {
            color: var(--burgundy);
            transform: translateX(4px);
        }

        /* Recipe Grid */
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 2.5rem;
        }

        /* Recipe Card - Vintage Index Card Style */
        .recipe-card {
            background: var(--antique-white);
            border-radius: 4px;
            border: 1px solid rgba(139, 90, 43, 0.15);
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.08),
                0 8px 24px rgba(0, 0, 0, 0.12),
                0 1px 2px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: cardReveal 0.6s ease forwards;
        }

        .recipe-card:hover {
            border-color: rgba(139, 90, 43, 0.25);
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.1),
                0 12px 32px rgba(0, 0, 0, 0.15),
                0 2px 4px rgba(0, 0, 0, 0.08);
        }

        .recipe-card:nth-child(1) { animation-delay: 0.05s; }
        .recipe-card:nth-child(2) { animation-delay: 0.1s; }
        .recipe-card:nth-child(3) { animation-delay: 0.15s; }
        .recipe-card:nth-child(4) { animation-delay: 0.2s; }
        .recipe-card:nth-child(5) { animation-delay: 0.25s; }
        .recipe-card:nth-child(6) { animation-delay: 0.3s; }
        .recipe-card:nth-child(7) { animation-delay: 0.35s; }
        .recipe-card:nth-child(8) { animation-delay: 0.4s; }
        .recipe-card:nth-child(9) { animation-delay: 0.45s; }

        .recipe-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 28px;
            background: repeating-linear-gradient(
                to bottom,
                transparent,
                transparent 7px,
                var(--sage-light) 7px,
                var(--sage-light) 8px
            );
            opacity: 0.3;
        }

        .recipe-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 30px;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, #E8B4B8 0%, transparent 100%);
            opacity: 0.5;
        }

        .recipe-card:hover {
            transform: translateY(-8px) rotate(-0.5deg);
            box-shadow:
                0 2px 4px var(--paper-shadow),
                0 12px 40px var(--paper-shadow),
                6px 6px 0 var(--cream-dark);
        }

        .recipe-card.hidden {
            display: none;
        }

        .recipe-header {
            padding: 2rem 1.5rem 1rem 2.5rem;
            position: relative;
        }

        .recipe-header h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--burgundy);
            line-height: 1.3;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .recipe-header h2:hover {
            color: var(--brown);
            text-decoration: underline;
        }

        .recipe-category-tag {
            display: inline-block;
            font-family: 'Caveat', cursive;
            font-size: 1rem;
            color: var(--brown-light);
            background: var(--cream);
            padding: 0.2rem 0.75rem;
            border-radius: 100px;
            border: 1px dashed var(--cream-dark);
        }

        .recipe-body {
            padding: 0.5rem 1.5rem 1rem 2.5rem;
        }

        .recipe-meta {
            font-family: 'Crimson Pro', serif;
            font-size: 0.9rem;
            color: var(--brown-light);
            margin-bottom: 0.75rem;
            font-style: italic;
        }

        .recipe-preview {
            font-size: 0.95rem;
            color: var(--brown);
            line-height: 1.6;
        }

        .recipe-preview strong {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
            color: var(--burgundy-dark);
        }

        .view-recipe-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            background: var(--cream);
            border: none;
            border-top: 1px dashed var(--cream-dark);
            color: var(--burgundy);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-recipe-btn:hover {
            background: var(--burgundy);
            color: var(--antique-white);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 36, 22, 0.85);
            backdrop-filter: blur(4px);
            z-index: 1001;
            overflow-y: auto;
            padding: 2rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            opacity: 1;
        }

        .modal-content {
            background: var(--antique-white);
            border-radius: 4px;
            max-width: 800px;
            width: 100%;
            margin: 2rem auto;
            position: relative;
            box-shadow:
                0 4px 20px rgba(0,0,0,0.2),
                0 20px 60px rgba(0,0,0,0.3);
            transform: translateY(20px);
            animation: modalSlideIn 0.4s ease forwards;
        }

        @keyframes modalSlideIn {
            to {
                transform: translateY(0);
            }
        }

        .modal-header {
            background: var(--burgundy);
            padding: 2.5rem 2rem;
            position: relative;
            text-align: center;
        }

        .modal-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: repeating-linear-gradient(
                90deg,
                var(--gold) 0px,
                var(--gold) 20px,
                transparent 20px,
                transparent 25px
            );
        }

        .modal-header h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.2rem;
            font-weight: 500;
            color: var(--antique-white);
            margin-bottom: 0.5rem;
        }

        .modal-category {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            color: var(--gold-light);
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 56px;
            height: 56px;
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 50%;
            color: var(--antique-white);
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .close-btn:hover,
        .close-btn:active {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 2.5rem;
        }

        .modal-meta {
            text-align: center;
            font-family: 'Crimson Pro', serif;
            font-style: italic;
            color: var(--brown-light);
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--cream-dark);
        }

        .modal-section {
            margin-bottom: 2.5rem;
        }

        .modal-section h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--burgundy);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-section h3::before {
            content: '';
            width: 24px;
            height: 2px;
            background: var(--gold);
        }

        .ingredients-list {
            list-style: none;
            columns: 2;
            column-gap: 2rem;
        }

        .ingredients-list li {
            padding: 0.5rem 0;
            border-bottom: 1px dotted var(--cream-dark);
            break-inside: avoid;
            position: relative;
            padding-left: 1.25rem;
        }

        .ingredients-list li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--burgundy);
            font-weight: bold;
        }

        .ingredient-qty {
            font-weight: 700;
            color: var(--burgundy);
        }

        .instructions-list {
            list-style: none;
            counter-reset: step;
        }

        .instructions-list li {
            position: relative;
            padding: 1rem 0 1rem 3.5rem;
            border-bottom: 1px dashed var(--cream-dark);
        }

        .instructions-list li:last-child {
            border-bottom: none;
        }

        .instructions-list li::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 1rem;
            width: 2.2rem;
            height: 2.2rem;
            background: var(--burgundy);
            color: var(--antique-white);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notes-box {
            background: var(--cream);
            padding: 1.5rem;
            border-radius: 4px;
            border-left: 4px solid var(--gold);
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            color: var(--brown);
            line-height: 1.5;
        }

        /* Interactive Checklists - tap to cross off */
        .ingredients-list li,
        .instructions-list li {
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: all 0.2s ease;
        }

        .ingredients-list li:hover,
        .instructions-list li:hover {
            background: rgba(114, 47, 55, 0.05);
        }

        .ingredients-list li.checked,
        .instructions-list li.checked {
            text-decoration: line-through;
            opacity: 0.5;
            color: var(--brown-light);
        }

        .instructions-list li.checked::before {
            background: var(--sage);
        }

        /* Servings Scaler */
        .scaler-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            background: var(--cream);
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .scaler-label {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--brown);
        }

        .scaler-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .scaler-btn {
            min-width: 56px;
            min-height: 56px;
            padding: 0.75rem 1.25rem;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-weight: 600;
            border: 2px solid var(--burgundy);
            background: transparent;
            color: var(--burgundy);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .scaler-btn:hover,
        .scaler-btn.active {
            background: var(--burgundy);
            color: var(--antique-white);
        }

        .scaler-btn.active {
            box-shadow: 0 2px 8px rgba(114, 47, 55, 0.3);
        }

        /* Wake Lock Indicator */
        .wake-lock-indicator {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: var(--burgundy);
            color: var(--antique-white);
            padding: 0.5rem 1rem;
            border-radius: 100px;
            font-family: 'Crimson Pro', serif;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1002;
            pointer-events: none;
        }

        .wake-lock-indicator.visible {
            opacity: 1;
        }

        .original-photo-section {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px dashed var(--cream-dark);
        }

        .original-photo-section h4 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--brown-light);
            margin-bottom: 1rem;
        }

        .recipe-card-thumbnails {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .recipe-card-thumbnail {
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .recipe-card-thumbnail img {
            max-width: 160px;
            max-height: 120px;
            border-radius: 4px;
            border: 2px solid var(--cream-dark);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .recipe-card-thumbnail:hover img {
            border-color: var(--burgundy);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
            transform: scale(1.05);
        }

        .recipe-card-thumbnail span {
            display: block;
            font-family: 'Crimson Pro', serif;
            font-size: 0.8rem;
            color: var(--brown-light);
            margin-top: 0.5rem;
        }

        /* Photo Gallery Modal */
        .photo-gallery-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem;
        }

        .photo-gallery-modal.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .photo-gallery-header {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .photo-gallery-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            color: var(--antique-white);
        }

        .photo-gallery-close {
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            color: var(--antique-white);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-gallery-close:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }

        .photo-gallery-images {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            max-width: 1200px;
        }

        .photo-gallery-images img {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .photo-gallery-label {
            text-align: center;
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            color: var(--gold-light);
            margin-top: 0.5rem;
        }

        .photo-gallery-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @media (max-width: 768px) {
            .photo-gallery-images {
                flex-direction: column;
            }
            .photo-gallery-images img {
                max-height: 50vh;
            }
        }

        /* Animations */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes cardReveal {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Print Styles */
        @media print {
            body::before,
            .controls,
            .modal,
            header,
            .view-recipe-btn,
            .print-btn,
            .toc-section {
                display: none !important;
            }

            body {
                background: white;
                font-size: 12pt;
            }

            .recipe-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }

            .recipe-grid {
                display: block;
            }

            .recipe-card {
                margin-bottom: 1rem;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 1rem 1.5rem;
            }

            header h1 {
                font-size: 1.4rem;
            }

            header .subtitle {
                font-size: 0.95rem;
            }

            .controls {
                padding: 0.6rem 1rem;
            }

            .controls-inner {
                gap: 0.5rem;
                flex-direction: column;
            }

            .search-container {
                width: 100%;
                flex: 1 1 100%;
            }

            .category-filters {
                gap: 0.25rem;
            }

            .filter-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }

            main {
                padding: 1.5rem 1rem;
            }

            .toc-section {
                padding: 1.5rem 1rem;
                margin-bottom: 2rem;
            }

            .recipe-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .modal {
                padding: 0.5rem;
            }

            .modal-content {
                margin: 0.5rem auto;
            }

            .modal-header {
                padding: 1.5rem 1rem;
            }

            .modal-header h2 {
                font-size: 1.5rem;
            }

            .modal-body {
                padding: 1.25rem;
            }

            .ingredients-list {
                columns: 1;
            }

            .instructions-list li {
                padding-left: 3rem;
            }
        }

    </style>
</head>
<body>
    <header>
        <img src="header-banner.png" alt="Family Cookbook" class="header-banner">
        <div class="header-content">
            <h1>Family Recipe Collection</h1>
            <p class="subtitle">Treasured recipes passed down through generations</p>
        </div>
    </header>

    <div class="controls">
        <div class="controls-inner">
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search recipes, ingredients..." onkeyup="filterRecipes()">
            </div>
            <div class="category-filters" id="categoryFilters">
                <button class="filter-btn active" data-category="all" onclick="filterByCategory('all')">All Recipes</button>
            </div>
            <button class="print-btn" onclick="window.print()">Print Cookbook</button>
        </div>
    </div>

    <div class="stats" id="statsBar">
        Loading recipes...
    </div>

    <main>
        <div class="recipe-grid" id="recipeGrid">
            <!-- Recipe cards will be dynamically generated -->
        </div>

        <section class="toc-section" id="tocSection">
            <h2>Full Recipe Index</h2>
            <div class="toc-columns" id="tocContent">
                <!-- TOC will be dynamically generated -->
            </div>
        </section>
    </main>

    <!-- Recipe Modal -->
    <div class="modal" id="recipeModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close-btn" onclick="closeModal()">&times;</button>
                <h2 id="modalTitle">Recipe Name</h2>
                <span class="modal-category" id="modalCategory">Category</span>
            </div>
            <div class="modal-body">
                <div class="modal-meta" id="modalMeta"></div>

                <div class="scaler-section" id="scalerSection">
                    <span class="scaler-label">Adjust servings:</span>
                    <div class="scaler-buttons">
                        <button class="scaler-btn" data-scale="0.5" onclick="scaleRecipe(0.5)">½×</button>
                        <button class="scaler-btn active" data-scale="1" onclick="scaleRecipe(1)">1×</button>
                        <button class="scaler-btn" data-scale="2" onclick="scaleRecipe(2)">2×</button>
                        <button class="scaler-btn" data-scale="3" onclick="scaleRecipe(3)">3×</button>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Ingredients <span style="font-weight: normal; font-size: 0.9rem; opacity: 0.7;">(tap to check off)</span></h3>
                    <ul class="ingredients-list" id="modalIngredients"></ul>
                </div>

                <div class="modal-section">
                    <h3>Instructions <span style="font-weight: normal; font-size: 0.9rem; opacity: 0.7;">(tap to check off)</span></h3>
                    <ol class="instructions-list" id="modalInstructions"></ol>
                </div>

                <div class="modal-section" id="modalNotesSection">
                    <h3>Notes</h3>
                    <div class="notes-box" id="modalNotes"></div>
                </div>

                <div class="modal-section original-photo-section">
                    <h4>Original Recipe Card</h4>
                    <div class="recipe-card-thumbnails" id="recipeCardThumbnails">
                        <!-- Thumbnails will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wake Lock Indicator -->
    <div class="wake-lock-indicator" id="wakeLockIndicator">☀️ Screen staying on</div>

    <!-- Photo Gallery Modal -->
    <div class="photo-gallery-modal" id="photoGalleryModal">
        <div class="photo-gallery-header">
            <h2 class="photo-gallery-title" id="photoGalleryTitle">Original Recipe Card</h2>
            <button class="photo-gallery-close" onclick="closePhotoGallery()">&times;</button>
        </div>
        <div class="photo-gallery-images" id="photoGalleryImages">
            <!-- Images will be inserted here -->
        </div>
    </div>

    <script src="recipe-data.js"></script>
    <script>
        // Initialize the cookbook
        document.addEventListener('DOMContentLoaded', function() {
            initializeCookbook();
        });

        function initializeCookbook() {
            generateCategoryButtons();
            generateTOC();
            generateRecipeCards();
            updateStats();
        }

        function generateCategoryButtons() {
            const categories = [...new Set(recipes.map(r => r.category))].sort();
            const container = document.getElementById('categoryFilters');

            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.dataset.category = category;
                btn.textContent = category;
                btn.onclick = () => filterByCategory(category);
                container.appendChild(btn);
            });
        }

        function generateTOC() {
            const categories = [...new Set(recipes.map(r => r.category))].sort();
            const container = document.getElementById('tocContent');
            container.innerHTML = '';

            categories.forEach(category => {
                const categoryRecipes = recipes.filter(r => r.category === category).sort((a, b) => a.name.localeCompare(b.name));

                const div = document.createElement('div');
                div.className = 'toc-category';
                div.innerHTML = `
                    <h3>${category} <span style="font-weight: normal; opacity: 0.6;">(${categoryRecipes.length})</span></h3>
                    <ul>
                        ${categoryRecipes.map(r => `<li><a href="#" onclick="openRecipe(${recipes.indexOf(r)}); return false;">${r.name}</a></li>`).join('')}
                    </ul>
                `;
                container.appendChild(div);
            });
        }

        function generateRecipeCards() {
            const container = document.getElementById('recipeGrid');
            container.innerHTML = '';

            recipes.forEach((recipe, index) => {
                const card = document.createElement('div');
                card.className = 'recipe-card';
                card.dataset.category = recipe.category;
                card.dataset.searchText = `${recipe.name} ${recipe.category} ${recipe.ingredients.join(' ')} ${recipe.notes || ''}`.toLowerCase();
                card.style.animationDelay = `${(index % 9) * 0.05 + 0.1}s`;

                const previewIngredients = recipe.ingredients.slice(0, 4).join(', ');
                const moreIngredients = recipe.ingredients.length > 4 ? ` +${recipe.ingredients.length - 4} more` : '';

                card.innerHTML = `
                    <div class="recipe-header">
                        <h2 class="recipe-title" onclick="openRecipe(${index})">${recipe.name}</h2>
                        <span class="recipe-category-tag">${recipe.category}</span>
                    </div>
                    <div class="recipe-body">
                        <div class="recipe-meta">
                            ${recipe.yield ? `Yield: ${recipe.yield}` : ''}
                        </div>
                        <div class="recipe-preview">
                            <strong>Ingredients:</strong> ${previewIngredients}${moreIngredients}
                        </div>
                    </div>
                    <button class="view-recipe-btn" onclick="openRecipe(${index})">View Full Recipe</button>
                `;
                container.appendChild(card);
            });
        }

        function filterRecipes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const activeCategory = document.querySelector('.filter-btn.active').dataset.category;

            // Create regex that matches word starts (prevents "pear" matching "appear")
            let searchRegex = null;
            if (searchTerm) {
                // Escape special regex characters and match at word boundaries (start of word)
                const escaped = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                // Match: start of string, or after a space/punctuation, followed by the search term
                searchRegex = new RegExp('(?:^|[\\s,;:()\\[\\]"\'/])' + escaped, 'i');
            }

            document.querySelectorAll('.recipe-card').forEach(card => {
                const matchesSearch = !searchTerm || searchRegex.test(card.dataset.searchText);
                const matchesCategory = activeCategory === 'all' || card.dataset.category === activeCategory;

                card.classList.toggle('hidden', !(matchesSearch && matchesCategory));
            });

            updateStats();
        }

        function filterByCategory(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            filterRecipes();
        }

        function updateStats() {
            const visible = document.querySelectorAll('.recipe-card:not(.hidden)').length;
            const total = recipes.length;
            document.getElementById('statsBar').textContent = `Showing ${visible} of ${total} treasured family recipes`;
        }

        let currentRecipeFile = '';
        let currentRecipeName = '';
        let currentRecipeIndex = -1;
        let currentScale = 1;
        let wakeLock = null;

        // Wake Lock API - keep screen on while cooking
        async function requestWakeLock() {
            if ('wakeLock' in navigator) {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    const indicator = document.getElementById('wakeLockIndicator');
                    indicator.classList.add('visible');
                    setTimeout(() => indicator.classList.remove('visible'), 2000);

                    wakeLock.addEventListener('release', () => {
                        wakeLock = null;
                    });
                } catch (err) {
                    console.log('Wake Lock not available:', err);
                }
            }
        }

        async function releaseWakeLock() {
            if (wakeLock) {
                await wakeLock.release();
                wakeLock = null;
            }
        }

        // Re-acquire wake lock when page becomes visible again
        document.addEventListener('visibilitychange', async () => {
            if (document.visibilityState === 'visible' && document.getElementById('recipeModal').classList.contains('active')) {
                await requestWakeLock();
            }
        });

        // Ingredient scaling - parse and scale quantities
        function parseQuantity(text) {
            // Match fractions, mixed numbers, decimals, and whole numbers at the start
            const patterns = [
                /^(\d+)\s+(\d+)\/(\d+)/, // Mixed number: 1 1/2
                /^(\d+)\/(\d+)/,          // Fraction: 1/2
                /^(\d+\.?\d*)/            // Decimal or whole: 1.5 or 2
            ];

            for (let pattern of patterns) {
                const match = text.match(pattern);
                if (match) {
                    if (match.length === 4) {
                        // Mixed number
                        return { value: parseInt(match[1]) + parseInt(match[2]) / parseInt(match[3]), end: match[0].length };
                    } else if (match.length === 3 && pattern.source.includes('/')) {
                        // Fraction
                        return { value: parseInt(match[1]) / parseInt(match[2]), end: match[0].length };
                    } else {
                        // Decimal or whole
                        return { value: parseFloat(match[1]), end: match[0].length };
                    }
                }
            }
            return null;
        }

        function formatQuantity(num) {
            // Common fractions
            const fractions = {
                0.125: '⅛', 0.25: '¼', 0.333: '⅓', 0.375: '⅜',
                0.5: '½', 0.625: '⅝', 0.666: '⅔', 0.75: '¾', 0.875: '⅞'
            };

            const whole = Math.floor(num);
            const frac = num - whole;

            // Find closest fraction
            let closestFrac = '';
            let minDiff = 0.1;
            for (let [val, sym] of Object.entries(fractions)) {
                const diff = Math.abs(frac - parseFloat(val));
                if (diff < minDiff) {
                    minDiff = diff;
                    closestFrac = sym;
                }
            }

            if (minDiff < 0.05) {
                return whole > 0 ? `${whole} ${closestFrac}` : closestFrac;
            }

            // Otherwise use decimal, but clean it up
            if (num === Math.floor(num)) {
                return num.toString();
            }
            return num.toFixed(2).replace(/\.?0+$/, '');
        }

        function scaleIngredient(text, scale) {
            const parsed = parseQuantity(text);
            if (parsed) {
                const scaledValue = parsed.value * scale;
                const formattedValue = formatQuantity(scaledValue);
                return formattedValue + text.substring(parsed.end);
            }
            return text;
        }

        // Format ingredient with bold quantity
        function formatIngredientWithBoldQty(text, scale = 1) {
            const parsed = parseQuantity(text);
            if (parsed) {
                let qty = text.substring(0, parsed.end);
                let rest = text.substring(parsed.end);

                if (scale !== 1) {
                    const scaledValue = parsed.value * scale;
                    qty = formatQuantity(scaledValue);
                }

                return `<span class="ingredient-qty">${qty}</span>${rest}`;
            }
            return text;
        }

        function scaleRecipe(scale) {
            currentScale = scale;

            // Update button states
            document.querySelectorAll('.scaler-btn').forEach(btn => {
                btn.classList.toggle('active', parseFloat(btn.dataset.scale) === scale);
            });

            // Re-render ingredients with new scale and bold quantities
            const recipe = recipes[currentRecipeIndex];
            const ingredientsList = document.getElementById('modalIngredients');
            ingredientsList.innerHTML = recipe.ingredients.map(ingredient => {
                return `<li>${formatIngredientWithBoldQty(ingredient, scale)}</li>`;
            }).join('');

            // Re-attach click handlers
            attachChecklistHandlers();
        }

        // Checklist functionality - tap to strike through
        function attachChecklistHandlers() {
            document.querySelectorAll('.ingredients-list li, .instructions-list li').forEach(li => {
                li.onclick = function() {
                    this.classList.toggle('checked');
                };
            });
        }

        function openRecipe(index) {
            const recipe = recipes[index];
            currentRecipeIndex = index;
            currentScale = 1;

            document.getElementById('modalTitle').textContent = recipe.name;
            document.getElementById('modalCategory').textContent = recipe.category;

            const metaHtml = recipe.yield ? `Yield: ${recipe.yield}` : '';
            document.getElementById('modalMeta').innerHTML = metaHtml;
            document.getElementById('modalMeta').style.display = metaHtml ? 'block' : 'none';

            // Render ingredients with bold quantities
            document.getElementById('modalIngredients').innerHTML = recipe.ingredients.map(i =>
                `<li>${formatIngredientWithBoldQty(i)}</li>`
            ).join('');
            document.getElementById('modalInstructions').innerHTML = recipe.instructions.map(i => `<li>${i}</li>`).join('');

            const notesSection = document.getElementById('modalNotesSection');
            if (recipe.notes) {
                notesSection.style.display = 'block';
                document.getElementById('modalNotes').textContent = recipe.notes;
            } else {
                notesSection.style.display = 'none';
            }

            // Store current recipe file for photo gallery
            currentRecipeFile = recipe.originalFile;
            currentRecipeName = recipe.name;

            // Set up thumbnail images (front and back if available)
            const thumbnailsContainer = document.getElementById('recipeCardThumbnails');
            thumbnailsContainer.innerHTML = '';

            const baseName = recipe.originalFile.replace('.jpg', '');
            const possibleImages = [
                { file: recipe.originalFile, label: 'Front' },
                { file: baseName + '-back.jpg', label: 'Back' },
                { file: baseName + '-2.jpg', label: 'Page 2' }
            ];

            possibleImages.forEach(imgInfo => {
                const thumb = document.createElement('div');
                thumb.className = 'recipe-card-thumbnail';
                thumb.onclick = openPhotoGallery;

                const img = document.createElement('img');
                img.src = 'web-images/' + imgInfo.file;
                img.alt = imgInfo.label;
                img.onerror = function() {
                    thumb.remove();
                };

                const label = document.createElement('span');
                label.textContent = imgInfo.label + ' - Tap to enlarge';

                thumb.appendChild(img);
                thumb.appendChild(label);
                thumbnailsContainer.appendChild(thumb);
            });

            // Reset scaler buttons
            document.querySelectorAll('.scaler-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.scale === '1');
            });

            // Attach checklist click handlers
            attachChecklistHandlers();

            document.getElementById('recipeModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Request wake lock to keep screen on while cooking
            requestWakeLock();
        }

        function openPhotoGallery() {
            const galleryImages = document.getElementById('photoGalleryImages');
            const galleryTitle = document.getElementById('photoGalleryTitle');

            galleryTitle.textContent = currentRecipeName + ' - Original Recipe Card';
            galleryImages.innerHTML = '';

            // Get the base filename
            const baseName = currentRecipeFile.replace('.jpg', '');

            // Create image elements
            const createImageItem = (src, label) => {
                const item = document.createElement('div');
                item.className = 'photo-gallery-item';

                const img = document.createElement('img');
                img.src = 'web-images/' + src;
                img.alt = label;
                img.onerror = function() { this.parentElement.style.display = 'none'; };

                const labelDiv = document.createElement('div');
                labelDiv.className = 'photo-gallery-label';
                labelDiv.textContent = label;

                item.appendChild(img);
                item.appendChild(labelDiv);
                return item;
            };

            // Add main image
            galleryImages.appendChild(createImageItem(currentRecipeFile, 'Front'));

            // Try to add back image if it exists
            const backFile = baseName + '-back.jpg';
            const imgBack = new Image();
            imgBack.onload = function() {
                galleryImages.appendChild(createImageItem(backFile, 'Back'));
            };
            imgBack.src = 'web-images/' + backFile;

            // Try to add -2 version if it exists
            const secondFile = baseName + '-2.jpg';
            const img2 = new Image();
            img2.onload = function() {
                galleryImages.appendChild(createImageItem(secondFile, 'Page 2'));
            };
            img2.src = 'web-images/' + secondFile;

            document.getElementById('photoGalleryModal').classList.add('active');
        }

        function closePhotoGallery() {
            document.getElementById('photoGalleryModal').classList.remove('active');
        }

        function closeModal() {
            document.getElementById('recipeModal').classList.remove('active');
            document.body.style.overflow = '';
            // Release wake lock when closing recipe
            releaseWakeLock();
        }

        // Close modal on escape key or clicking outside
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (document.getElementById('photoGalleryModal').classList.contains('active')) {
                    closePhotoGallery();
                } else {
                    closeModal();
                }
            }
        });

        document.getElementById('recipeModal').addEventListener('click', (e) => {
            if (e.target.id === 'recipeModal') closeModal();
        });

        document.getElementById('photoGalleryModal').addEventListener('click', (e) => {
            if (e.target.id === 'photoGalleryModal') closePhotoGallery();
        });
    </script>
</body>
</html>
